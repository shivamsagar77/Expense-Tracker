PAYMENT FLOW DIAGRAM
====================

1. USER INTERACTION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   User Login    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Payment Button  â”‚
   â”‚     Click       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Fill Form      â”‚
   â”‚ (Phone, Email)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Pay Now       â”‚
   â”‚    Button       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼

2. BACKEND API CALLS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /payment/  â”‚
   â”‚ create-order    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Cashfree API    â”‚
   â”‚ Order Creation  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Payment Session â”‚
   â”‚      ID         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Cashfree Popup  â”‚
   â”‚   Payment UI    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Payment Success â”‚
   â”‚   Response      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼

3. DATABASE STORAGE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /payment/  â”‚
   â”‚     store       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Transaction   â”‚
   â”‚     Start       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 1:       â”‚
   â”‚   payments      â”‚
   â”‚ (Main Record)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 2:       â”‚
   â”‚payment_gateway_ â”‚
   â”‚   details       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 3:       â”‚
   â”‚payment_method_  â”‚
   â”‚   details       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 4:       â”‚
   â”‚payment_surchargeâ”‚
   â”‚   _details      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 5:       â”‚
   â”‚international_   â”‚
   â”‚payment_details  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 6:       â”‚
   â”‚ payment_offers  â”‚
   â”‚   (Optional)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Table 7:       â”‚
   â”‚payment_error_   â”‚
   â”‚   details       â”‚
   â”‚   (Optional)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Transaction   â”‚
   â”‚    Commit       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Payment ID      â”‚
   â”‚   Returned      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. DATA RETRIEVAL
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /payment/   â”‚
   â”‚ data/:paymentId â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Fetch Payment   â”‚
   â”‚ with All        â”‚
   â”‚ Associations    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Complete        â”‚
   â”‚ Payment Data    â”‚
   â”‚ Returned        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. USER PAYMENTS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /payment/   â”‚
   â”‚ user-payments   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Fetch All       â”‚
   â”‚ User Payments   â”‚
   â”‚ with Gateway    â”‚
   â”‚ & Method Detailsâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Payment History â”‚
   â”‚   Returned      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE TABLES STRUCTURE
=========================

payments (Main Table)
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ cf_payment_id (Unique)
â”œâ”€â”€ order_id
â”œâ”€â”€ user_id (Foreign Key)
â”œâ”€â”€ payment_amount
â”œâ”€â”€ payment_status
â”œâ”€â”€ authorizations
â””â”€â”€ ... other fields

payment_gateway_details
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ gateway_name
â”œâ”€â”€ gateway_settlement
â””â”€â”€ ... other fields

payment_method_details
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ method_type
â”œâ”€â”€ upi_id
â””â”€â”€ ... other fields

payment_surcharge_details
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ service_charge
â”œâ”€â”€ service_tax
â””â”€â”€ total_surcharge

international_payment_details
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ is_international
â””â”€â”€ ... other fields

payment_offers (Optional)
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ offer_id
â”œâ”€â”€ discount_amount
â””â”€â”€ ... other fields

payment_error_details (Optional)
â”œâ”€â”€ id (Primary Key)
â”œâ”€â”€ payment_id (Foreign Key â†’ payments.id)
â”œâ”€â”€ error_code
â”œâ”€â”€ error_message
â””â”€â”€ ... other fields

API TO TABLE MAPPING
====================

POST /payment/create-order
â”œâ”€â”€ âŒ No database entry
â””â”€â”€ ğŸ”„ Cashfree API call only

POST /payment/store
â”œâ”€â”€ âœ… payments (main record)
â”œâ”€â”€ âœ… payment_gateway_details
â”œâ”€â”€ âœ… payment_method_details
â”œâ”€â”€ âœ… payment_surcharge_details
â”œâ”€â”€ âœ… international_payment_details
â”œâ”€â”€ âœ… payment_offers (if any)
â””â”€â”€ âœ… payment_error_details (if any)

GET /payment/data/:paymentId
â”œâ”€â”€ âœ… payments (main record)
â”œâ”€â”€ âœ… payment_gateway_details (via association)
â”œâ”€â”€ âœ… payment_method_details (via association)
â”œâ”€â”€ âœ… payment_surcharge_details (via association)
â”œâ”€â”€ âœ… international_payment_details (via association)
â”œâ”€â”€ âœ… payment_offers (via association)
â””â”€â”€ âœ… payment_error_details (via association)

GET /payment/user-payments
â”œâ”€â”€ âœ… payments (filtered by user_id)
â”œâ”€â”€ âœ… payment_gateway_details (via association)
â””â”€â”€ âœ… payment_method_details (via association)

GET /payment/status/:orderId
â”œâ”€â”€ âŒ No database entry
â””â”€â”€ ğŸ”„ Cashfree API call only

POST /payment/callback
â”œâ”€â”€ ğŸ“ Logs only
â””â”€â”€ ğŸ”„ Update status (if needed)
